<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>reveal.js</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/sb1.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
	<div class="reveal">
		<div class="slides">
			<section>
				<h1>Content Security Policy i praksis</h1>
				<h2>Jon Are Rakvåg</h2>
				<h3>SpareBank 1</h3>
			</section>

			<section>
				<h3>Websikkerhet er vanskelig</h3>
				<div class="fragment fade-in">CSP er nesten gratis vaksine mot Cross-site scripting (XSS), click-jacking, flere typer injection, flere typer informasjonslekkasje</div>
			</section>

			<section>//TODO: illustrasjon av server som lover nettleser hvordan den har tenkt å oppføre seg</section>

			<section>
<pre><code>HTTP/1.1 200 OK
Content-Security-Policy: ...
Content-Security-Policy-Report-Only: ...</code></pre>
				<pre class="fragment">
<code>&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Security-Policy" content="..."&gt;
&lt;meta http-equiv="Content-Security-Policy-Report-Only"
 content="..."&gt;</code></pre>
			</section>

			<section>
<pre><code data-noescape class="hljs csp">Content-Security-Policy: <i>directive</i>; <i>directive</i>; <i>directive</i></code></pre>
			</section>

			<section>
				<pre><code data-noescape class="hljs csp">Content-Security-Policy: default-src 'self';
                         report-uri /log/csp</code></pre>
				<aside class="notes">
					Nyttig CSP i sin aller enkleste form
					Ikke så realistisk
					Forklar directivene
						default-src
						'self'
						report-uri
							Superfin JSON POST
					I det virkelige liv også litt vanskelig
					default-src er sekkeposten, der vi ikke har spesifisert directivet
					CSP-rapportene inkluderer hvilket directive som ble brutt, og "default-src" gir ingen hjelp
				</aside>
			</section>

			<section>
				<pre><code data-noescape class="hljs csp">Content-Security-Policy: default-src 'self';
                         script-src js.sparebank1.no;
                         style-src 'self';
                         img-src 'self' www.facebook.com;
                         object-src 'none';
                         report-uri /log/csp</code></pre>
				<aside class="notes">
					Noen viktige og vanlige directives
					Gå fort gjennom
					(Mangel på) arv
				</aside>
			</section>

			<section>
				<h2>Directives</h2>
				<table style="font-size: medium">
					<thead>
					<tr>
						<th>Fetch</th>
						<th>Document</th>
						<th>Navigation</th>
						<th>Reporting</th>
						<th>Other</th>
					</tr>
					</thead>
					<tbody>
					<tr>
						<td class="fragment dim" data-fragment-index="1">child-src</td>
						<td>base-uri</td>
						<td>form-action</td>
						<td>report-uri</td>
						<td class="fragment dim" data-fragment-index="1">block-all-mixed-content</td>
					</tr>
					<tr>
						<td>connect-src</td>
						<td>plugin-types</td>
						<td>frame-ancestors</td>
						<td class="fragment dim" data-fragment-index="1">report-to</td>
						<td class="fragment dim" data-fragment-index="1">referrer</td>
					</tr>
					<tr>
						<td>default-src</td>
						<td>sandbox</td>
						<td class="fragment dim" data-fragment-index="1">navigation-to</td>
						<td></td>
						<td>require-sri-for</td>
					</tr>
					<tr>
						<td>font-src</td>
						<td class="fragment dim" data-fragment-index="1">disown-opener</td>
						<td></td>
						<td></td>
						<td>upgrade-insecure-requests</td>
					</tr>
					<tr>
						<td>frame-src</td>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td>img-src</td>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td class="fragment semi-dim" data-fragment-index="2">manifest-src</td>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td>media-src</td>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td class="fragment highlight-1" data-fragment-index="3">object-src</td>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td class="fragment dim" data-fragment-index="1">prefetch-src</td>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td class="fragment highlight-1" data-fragment-index="3">script-src</td>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td class="fragment highlight-1" data-fragment-index="3">style-src</td>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td>worker-src</td>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
					</tr>
					</tbody>
				</table>
				<aside class="notes">
					CSP er en standard under utvikling.
					Mange directives, men noen er enten depricated, eller ikke støttet i nettleserne ennå

					...
				</aside>
			</section>

			<section>
				<aside class="notes">
					1. KWAHC
						Intro
						Legge inn XSS payload
							Det er ikke bra, og en av situasjonene der CSP kan hjelpe.
					2. Bygge opp første versjon CSP i report-uri
						Trykk gjennom
						Generer og les gjennom
					3. Få CSP inn på server
						Kan legge inn som vanlig kode, men
							Ofte vil ikke testsystem og prodsystem være helt likt ned på de viktige detaljene med CSP. -Hostnavn, innhold kan være litt forskjellig
						Vi kan ta et skritt tilbake, og utnytte at arkitekturen er som den er. Dette er en kontrakt mellom server og nettleser. Vi kan steppe inn mellom
						server og nettleser, og injisere vår egen CSP ved å modifisere http-responsen
					4. OWASP ZAP
						Intro, launch Chrome, replacer
						Vis CSP i Chrome for KWASHC
							Bare vi i hele verden som har denne CSP'en
							Men det gjelder for oss for alle sider i hele verden
					5. Utvid CSP gjennom konsollfeilmeldinger
						...
						unsafe-inline vs hash vs nonce
							unngå unsafe-inline
							hash: oppgitt og enklet, men brekker om man endrer på et eneste tegn i scriptet. Velegnet dersom man har legacy inline-kode.
							nonce: kommer tilbake til det
				</aside>
			</section>

			<section>
				<aside class="notes">
					Kjør policy gjennom https://csp-evaluator.withgoogle.com/
						Legg til www.google.com på script, vis advarselen

					strict-dynamic


				</aside>
			</section>

			<section>
				<aside class="notes">
					...reporting

				</aside>
			</section>

			<section>
				<aside class="notes">
					...oppsummering


					Du vil unngå unsafe-inline, unsafe-eval, data:

				</aside>
			</section>

		</div>
	</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				],
              transition: 'convex',
              history: true
			});
		</script>
	</body>
</html>
